!function(){"use strict";var e={481:function(e,n,r){var t=r(762),a=r(62),o=r(984).Chess,i=[["a8","b8","c8","d8","e8","f8","g8","h8"],["a7","b7","c7","d7","e7","f7","g7","h7"],["a6","b6","c6","d6","e6","f6","g6","h6"],["a5","b5","c5","d5","e5","f5","g5","h5"],["a4","b4","c4","d4","e4","f4","g4","h4"],["a3","b3","c3","d3","e3","f3","g3","h3"],["a2","b2","c2","d2","e2","f2","g2","h2"],["a1","b1","c1","d1","e1","f1","g1","h1"]],f=new RegExp("[#+]$"),s=new RegExp("#$"),c={1:"45678",2:"5678",3:"678",4:"78",5:"8"},u={a:"defgh",b:"efgh",c:"fgh",d:"gh",e:"h"},l=[];self.onmessage=function(e){var n=JSON.parse(e.data),r=n.pieces,h=n.fromSquare,v=n.nSquares,p=n.testFen,d=p?new o(p):new o;p||d.clear();var g=0,m=r.includes("Q")&&r.includes("N");m&&g++;for(var b=0,y=0;y<i.length&&-1===(b=i[y].indexOf(h));y++);for(var O=b+v,x=[],M=0;M<v-y;M++)x.push.apply(x,(0,a.Z)(i[y+M].slice(b,O)));var k=function(e){for(var n=e.map((function(e){return e.charAt(1)})).sort(),r=0;r<n.length-1;r++)if(!["6","7","8"].includes(n[r])&&c[n[r]].includes(n[r+1]))return!0;for(var t=e.map((function(e){return e.charAt(0)})).sort(),a=0;a<t.length-1;a++)if(!["f","g","h"].includes(t[a])&&u[t[a]].includes(t[a+1]))return!0;return!1},w="abcdefgh",A=function(e,n){var r=Math.max.apply(Math,(0,a.Z)(e.map((function(e){return parseInt(e.charAt(1))})))),t=Math.min.apply(Math,(0,a.Z)(n.map((function(e){return parseInt(e.charAt(1))}))));if(Math.abs(r-t)>1)return!0;var o=Math.max.apply(Math,(0,a.Z)(e.map((function(e){return w.indexOf(e.charAt(0))})))),i=Math.min.apply(Math,(0,a.Z)(n.map((function(e){return w.indexOf(e.charAt(0))}))));return Math.abs(o-i)>1},S=function(e){if(m){for(var n=null,r=null,t=0;t<8&&(!n||!r);t++)for(var a=e[t],o=0;o<8&&(!n||!r);o++)if(a[o]){var i=a[o],f=i.type,s=i.color,c=i.square;"q"===f&&"w"===s?n=c:"n"===f&&"w"===s&&(r=c)}if(!r||!n)return!1;var u=parseInt(n.charAt(1)),l=w.indexOf(n.charAt(0)),h=parseInt(r.charAt(1)),v=w.indexOf(r.charAt(0));return l===v&&2===Math.abs(u-h)||u===h&&2===Math.abs(l-v)}return!1},Z=function(){var e,n=d.moves().filter((function(e){return!f.test(e)&&!e.includes("x")})),r=0,a=null,o=!1,i=(0,t.Z)(n);try{for(i.s();!(e=i.n()).done;){var c=e.value;d.move(c);var u=d.moves(),l=0;o=!1;var h,v=(0,t.Z)(u);try{for(v.s();!(h=v.n()).done;){var m=h.value;d.move(m);var b=d.moves().filter((function(e){return s.test(e)}));if((l=b.length)>0&&g>0){var y,O=(0,t.Z)(b);try{for(O.s();!(y=O.n()).done;){var x=y.value;if(d.move(x),S(d.board())&&(o=!0,console.log("black:",m," white2:",x)),d.undo(),o)break}}catch(M){O.e(M)}finally{O.f()}}if(d.undo(),0===l)break}}catch(M){v.e(M)}finally{v.f()}l>0&&(0===g||o)&&(p&&console.log("checkmate at second move",c),r++,a=c,console.log("firstMove:",a)),d.undo()}}catch(M){i.e(M)}finally{i.f()}return p&&console.log(1===r?"Position is problem":"Position is not problem"),1===r?a:null},j=n.pieces.indexOf("k"),P=null;if(""===h)console.log("Invalid fromSquare");else if(p){console.time();var C=Z(),q={fen:p,firstMove:C};self.postMessage(JSON.stringify(q)),console.timeEnd()}else!function e(n,r){var o,i=n.shift().charAt(0),f=i.toLowerCase(),s=/[RNBKQP]/.test(i)?"w":"b",c="k"===i,u=(0,t.Z)(x);try{for(u.s();!(o=u.n()).done;){var h=o.value;if(!l.includes(h)&&("p"!==f||!h.includes("8")&&!h.includes("1"))){var v=d.put({type:f,color:s},h);if(d.isCheck()||c&&(d.isAttacked(h,"w")||h.endsWith("1")||h.endsWith("8")||h.startsWith("a")||h.startsWith("h"))||"b"===s&&d.isAttacked(l[0],"b"))d.remove(h);else if(v){var p=!1,g=!1,m=!1;if(c&&(P=null),l.push(h),r>0&&r<j){var b=l.slice(0,l.length);p=k(b)}else if(r>=j){var y=l.slice(j,l.length);if(y.length>1&&(g=k(y)),!g){var O=l.slice(0,j);g=A(O,y)}r===j&&(m=d.isAttacked(h,"w"))}if(!p&&!g&&!m)if(0===n.length){var M=d.fen(),w=Z();null!==w&&(w===P?w=null:(P=w,console.log("------",l,"---",M)));var S={fen:M,firstMove:w};self.postMessage(JSON.stringify(S))}else e((0,a.Z)(n),r+1);l.pop(),d.remove(h)}}}}catch(C){u.e(C)}finally{u.f()}}((0,a.Z)(n.pieces),0)}}},n={};function r(t){var a=n[t];if(void 0!==a)return a.exports;var o=n[t]={exports:{}};return e[t](o,o.exports,r),o.exports}r.m=e,r.x=function(){var e=r.O(void 0,[777],(function(){return r(481)}));return e=r.O(e)},function(){var e=[];r.O=function(n,t,a,o){if(!t){var i=1/0;for(u=0;u<e.length;u++){t=e[u][0],a=e[u][1],o=e[u][2];for(var f=!0,s=0;s<t.length;s++)(!1&o||i>=o)&&Object.keys(r.O).every((function(e){return r.O[e](t[s])}))?t.splice(s--,1):(f=!1,o<i&&(i=o));if(f){e.splice(u--,1);var c=a();void 0!==c&&(n=c)}}return n}o=o||0;for(var u=e.length;u>0&&e[u-1][2]>o;u--)e[u]=e[u-1];e[u]=[t,a,o]}}(),r.d=function(e,n){for(var t in n)r.o(n,t)&&!r.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})},r.f={},r.e=function(e){return Promise.all(Object.keys(r.f).reduce((function(n,t){return r.f[t](e,n),n}),[]))},r.u=function(e){return"static/js/"+e+".0e9f84b3.chunk.js"},r.miniCssF=function(e){},r.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.p="/chess-problem/",function(){var e={481:1};r.f.i=function(n,t){e[n]||importScripts(r.p+r.u(n))};var n=self.webpackChunkchess_game=self.webpackChunkchess_game||[],t=n.push.bind(n);n.push=function(n){var a=n[0],o=n[1],i=n[2];for(var f in o)r.o(o,f)&&(r.m[f]=o[f]);for(i&&i(r);a.length;)e[a.pop()]=1;t(n)}}(),function(){var e=r.x;r.x=function(){return r.e(777).then(e)}}();r.x()}();
//# sourceMappingURL=481.666b0052.chunk.js.map