!function(){"use strict";var e={505:function(e,r,n){for(var a=n(762),t=n(62),f=[["a8","b8","c8","d8","e8","f8","g8","h8"],["a7","b7","c7","d7","e7","f7","g7","h7"],["a6","b6","c6","d6","e6","f6","g6","h6"],["a5","b5","c5","d5","e5","f5","g5","h5"],["a4","b4","c4","d4","e4","f4","g4","h4"],["a3","b3","c3","d3","e3","f3","g3","h3"],["a2","b2","c2","d2","e2","f2","g2","h2"],["a1","b1","c1","d1","e1","f1","g1","h1"]],o="abcdefgh",i=function(e){for(var r=e.map((function(e){return e.i})).sort(),n=0;n<r.length-1;n++)if(r[n+1]-r[n]>3)return!0;r=e.map((function(e){return e.j})).sort();for(var a=0;a<r.length-1;a++)if(r[a+1]-r[a]>3)return!0;return!1},c=9,s=-1,u=9,l=-1,v=function(e){c=9,s=-1,u=9,l=-1;var r,n=(0,a.Z)(e);try{for(n.s();!(r=n.n()).done;){var t=r.value,f=t.i,o=t.j;f<c&&(c=f),f>s&&(s=f),o<u&&(u=o),o>l&&(l=o)}}catch(i){n.e(i)}finally{n.f()}},h=function(e){var r,n=(0,a.Z)(e);try{for(n.s();!(r=n.n()).done;){var t=r.value,f=t.i,o=t.j;if(f>=c&&f<=s&&o>=u&&o<=l)return!0}}catch(i){n.e(i)}finally{n.f()}return!1},d=[["a1","b2","c3","d4","e5","f6","g7","h8"],["a2","b3","c4","d5","e6","f7","g8"],["a3","b4","c5","d6","e7","f8"],["a4","b5","c6","d7","e8"],["a5","b6","c7","d8"],["a6","b7","c8"],["a7","b8"],["b1","c2","d3","e4","f5","g6","h7"],["c1","d2","e3","f4","g5","h6"],["d1","e2","f3","g4","h5"],["e1","f2","g3","h4"],["f1","g2","h3"],["g1","h2"]],p=[["h1","g2","f3","e4","d5","c6","b7","a8"],["h2","g3","f4","e5","d6","c7","b8"],["h3","g4","f5","e6","d7","c8"],["h4","g5","f6","e7","d8"],["h5","g6","f7","e8"],["h6","g7","f8"],["h7","g8"],["g1","f2","e3","d4","c5","b6","a7"],["f1","e2","d3","c4","b5","a6"],["e1","d2","c3","b4","a5"],["d1","c2","b3","a4"],["c1","b2","a3"],["b1","a2"]],b={},g=0,y=["1","2","3","4","5","6","7","8"];g<y.length;g++)for(var m=y[g],O=function(){var e=x[k]+m;b[e]=[];var r,n=(0,a.Z)(d);try{for(n.s();!(r=n.n()).done;){var f,o=r.value;o.includes(e)&&(f=b[e]).push.apply(f,(0,t.Z)(o.filter((function(r){return r!==e}))))}}catch(l){n.e(l)}finally{n.f()}var i,c=(0,a.Z)(p);try{for(c.s();!(i=c.n()).done;){var s,u=i.value;u.includes(e)&&(s=b[e]).push.apply(s,(0,t.Z)(u.filter((function(r){return r!==e}))))}}catch(l){c.e(l)}finally{c.f()}},k=0,x=["a","b","c","d","e","f","g","h"];k<x.length;k++)O();for(var Z=function(e,r){for(var n=null,a=null,t=0;t<8&&(!n||!a);t++)for(var f=e[t],i=0;i<8&&(!n||!a);i++)if(f[i]){var c=f[i],s=c.type,u=c.color,l=c.square;s===r&&"w"===u?n=l:"n"===s&&"w"===u&&(a=l)}if(!a||!n)return!1;var v,h=parseInt(n.charAt(1)),d=o.indexOf(n.charAt(0)),p=parseInt(a.charAt(1)),g=o.indexOf(a.charAt(0)),y=d===g&&(2===Math.abs(h-p)||4===Math.abs(h-p))||h===p&&(2===Math.abs(d-g)||4===Math.abs(d-g));return y||(v=a,y=b[n].includes(v)),y},w={},A=function(e,r){for(var n=[],a=e-1;a<=e+1;a++)if(!(a<1||a>8))for(var t=r-1;t<=r+1;t++)t<0||a>7||a===e&&t===r||n.push(o[t]+a);return n},M=1;M<=8;M++)for(var S=0;S<8;S++)w[o[S]+M]=A(M,S);var j=function(e,r){return w[e].includes(r)},q=n(984).Chess,C=new RegExp("[#+]$"),P=new RegExp("#$"),I=[];self.onmessage=function(e){var r=JSON.parse(e.data),n=(r.action,r.pieces),c=r.indexOfBlack,s=r.lookingForFen,u=r.fromSquare,l=r.toSquare,d=r.testFen,p=[],b=new q(d||s);if(!d){var g=function(e,r,n){for(var t=[],f=[],o=0;o<8;o++){f[o]=[];for(var i=0;i<8;i++)f[o][i]=!1}var c,s=(0,a.Z)(e);try{for(s.s();!(c=s.n()).done;)for(var u=c.value,l=["K","Q","R","B","N","P"].includes(u)?"w":"b",v=u.toLowerCase(),h=!1,d=0;d<8&&!h;d++)for(var p=r[d],b=0;b<8&&!h;b++){var g=p[b];if(g){var y=g,m=y.type,O=y.color,k=y.square;if(m===v&&O===l){var x="b"===m&&!f[d][b]&&"light"===n(k);f[d][b]=!0,t.push(x),h=!0}}}}catch(Z){s.e(Z)}finally{s.f()}return t}(n,b.board(),(function(e){return b.squareColor(e)}));p.push.apply(p,(0,t.Z)(g)),b.clear()}var y=0,m=n.includes("Q")&&n.includes("N");m&&y++;var O=n.includes("B")&&n.includes("N");O&&y++;var k=n.includes("R");k&&y++;var x,w=[],A=(0,a.Z)(f);try{for(A.s();!(x=A.n()).done;){var M=x.value;w.push.apply(w,(0,t.Z)(M))}}catch($){A.e($)}finally{A.f()}for(var S=[],N=!1,R=0,Q=w;R<Q.length;R++){var B=Q[R];B===u?N=!0:B===l&&(S.push(B),N=!1),N&&S.push(B)}var F=function(e){return!(!m||!Z(e,"q"))||(!(!O||!Z(e,"b"))||!(!k||!function(e){for(var r=null,n=null,t=[],f=0;f<8;f++)for(var i=e[f],c=0;c<8&&(!r||!n);c++)if(i[c]){var s=i[c],u=s.type,l=s.color,v=s.square;"k"===u?"w"===l?r=v:n=v:"r"===u&&"w"===l&&t.push(v)}var h=parseInt(r.charAt(1)),d=o.indexOf(r.charAt(0)),p=parseInt(n.charAt(1)),b=o.indexOf(n.charAt(0));if(h===p&&2===Math.abs(d-b)){var g,y=(0,a.Z)(t);try{for(y.s();!(g=y.n()).done;){var m=g.value;if(o.indexOf(m.charAt(0))===b)return!0}}catch($){y.e($)}finally{y.f()}}else if(d===b&&2===Math.abs(h-p)){var O,k=(0,a.Z)(t);try{for(k.s();!(O=k.n()).done;){var x=O.value;if(parseInt(x.charAt(1))===p)return!0}}catch($){k.e($)}finally{k.f()}}return!1}(e)))},J=function(){var e,r=b.moves().filter((function(e){return!C.test(e)&&!e.includes("x")})),n=0,t=null,f=!1,o=(0,a.Z)(r);try{for(o.s();!(e=o.n()).done;){var i=e.value;b.move(i);var c=b.moves(),s=0;f=!1;var u,l=(0,a.Z)(c);try{for(l.s();!(u=l.n()).done;){var v=u.value;b.move(v);var h=b.moves().filter((function(e){return P.test(e)&&!(e.includes("=Q")||e.includes("=R"))}));if((s=h.length)>0&&y>0){var p,g=(0,a.Z)(h);try{for(g.s();!(p=g.n()).done;){var m=p.value;if(b.move(m),F(b.board())&&(f=!0),b.undo(),f)break}}catch($){g.e($)}finally{g.f()}}if(b.undo(),0===s)break}}catch($){l.e($)}finally{l.f()}s>0&&(0===y||f)&&(d&&console.log("checkmate at second move",i),n++,t=i,console.log("firstMove:",t)),b.undo()}}catch($){o.e($)}finally{o.f()}return d&&console.log(1===n?"Position is problem":"Position is not problem"),1===n?t:null},_=[],E=[],K=!1,L=null;if(""===u)console.log("Invalid fromSquare");else if(d){console.time();var T=J(),W={fen:d,firstMove:T};self.postMessage(JSON.stringify(W)),console.timeEnd()}else!function e(r,n){var f,s=r.shift().charAt(0),u=s.toLowerCase(),l=/[RNBKQP]/.test(s)?"w":"b",d=n>=c,g="K"===s,y="k"===s,m="b"===u,O=m&&p[n],k=g?S:w,x=(0,a.Z)(k);try{for(x.s();!(f=x.n()).done;){var Z=f.value;if(K){if("w"!==l)break;K=!1}if(!I.includes(Z)&&("p"!==u||!Z.includes("8")&&!Z.includes("1"))){var A=b.put({type:u,color:l},Z),M=!1;if(m&&(O&&"dark"===b.squareColor(Z)||!O&&"light"===b.squareColor(Z))&&(M=!0),!M&&d&&(console.assert("b"===l,"Should be black piece"),y?(j(I[0],Z)||b.isAttacked(Z,"w"))&&(M=!0):b.isCheck()&&(M=!0,["q","r","b"].includes(u)&&!j(I[0],Z)&&(M=!1))),M)b.remove(Z);else if(A){var q=!1;if(y&&(L=null,v(_)),I.push(Z),d?E.push({i:parseInt(Z.charAt(1)),j:o.indexOf(Z.charAt(0))}):_.push({i:parseInt(Z.charAt(1)),j:o.indexOf(Z.charAt(0))}),n===c&&(q=i(_)),!q)if(0===r.length){if(!i(E)){var C=b.fen();if(h(E)){var P=J();null!==P&&(P===L||P.endsWith("=Q")||P.endsWith("=R")?P=null:(L=P,console.log("------",I,"---",C)));var N={fen:C,firstMove:P};self.postMessage(JSON.stringify(N))}else{var R={fen:C,firstMove:""};self.postMessage(JSON.stringify(R)),K=!0}}}else e((0,t.Z)(r),n+1);I.pop(),d?E.pop():_.pop(),b.remove(Z)}}}}catch($){x.e($)}finally{x.f()}}((0,t.Z)(r.pieces),0)}}},r={};function n(a){var t=r[a];if(void 0!==t)return t.exports;var f=r[a]={exports:{}};return e[a](f,f.exports,n),f.exports}n.m=e,n.x=function(){var e=n.O(void 0,[777],(function(){return n(505)}));return e=n.O(e)},function(){var e=[];n.O=function(r,a,t,f){if(!a){var o=1/0;for(u=0;u<e.length;u++){a=e[u][0],t=e[u][1],f=e[u][2];for(var i=!0,c=0;c<a.length;c++)(!1&f||o>=f)&&Object.keys(n.O).every((function(e){return n.O[e](a[c])}))?a.splice(c--,1):(i=!1,f<o&&(o=f));if(i){e.splice(u--,1);var s=t();void 0!==s&&(r=s)}}return r}f=f||0;for(var u=e.length;u>0&&e[u-1][2]>f;u--)e[u]=e[u-1];e[u]=[a,t,f]}}(),n.d=function(e,r){for(var a in r)n.o(r,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:r[a]})},n.f={},n.e=function(e){return Promise.all(Object.keys(n.f).reduce((function(r,a){return n.f[a](e,r),r}),[]))},n.u=function(e){return"static/js/"+e+".0e9f84b3.chunk.js"},n.miniCssF=function(e){},n.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="/chess-problem/",function(){var e={505:1};n.f.i=function(r,a){e[r]||importScripts(n.p+n.u(r))};var r=self.webpackChunkchess_game=self.webpackChunkchess_game||[],a=r.push.bind(r);r.push=function(r){var t=r[0],f=r[1],o=r[2];for(var i in f)n.o(f,i)&&(n.m[i]=f[i]);for(o&&o(n);t.length;)e[t.pop()]=1;a(r)}}(),function(){var e=n.x;n.x=function(){return n.e(777).then(e)}}();n.x()}();
//# sourceMappingURL=505.e03d6e26.chunk.js.map