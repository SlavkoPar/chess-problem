!function(){"use strict";var e={505:function(e,r,n){for(var t=n(62),a=n(762),o=[["a8","b8","c8","d8","e8","f8","g8","h8"],["a7","b7","c7","d7","e7","f7","g7","h7"],["a6","b6","c6","d6","e6","f6","g6","h6"],["a5","b5","c5","d5","e5","f5","g5","h5"],["a4","b4","c4","d4","e4","f4","g4","h4"],["a3","b3","c3","d3","e3","f3","g3","h3"],["a2","b2","c2","d2","e2","f2","g2","h2"],["a1","b1","c1","d1","e1","f1","g1","h1"]],f="abcdefgh",i=function(e){for(var r=e.map((function(e){return e.i})).sort(),n=0;n<r.length-1;n++)if(r[n+1]-r[n]>1)return!0;r=e.map((function(e){return e.j})).sort();for(var t=0;t<r.length-1;t++)if(r[t+1]-r[t]>1)return!0;return!1},c=9,s=-1,u=9,l=-1,h=function(e){c=9,s=-1,u=9,l=-1;var r,n=(0,a.Z)(e);try{for(n.s();!(r=n.n()).done;){var t=r.value,o=t.i,f=t.j;o<c&&(c=o),o>s&&(s=o),f<u&&(u=f),f>l&&(l=f)}}catch(i){n.e(i)}finally{n.f()}},v=function(e){var r,n=(0,a.Z)(e);try{for(n.s();!(r=n.n()).done;){var t=r.value,o=t.i,f=t.j;if(o>=c&&o<=s&&f>=u&&f<=l)return!0}}catch(i){n.e(i)}finally{n.f()}return!1},d=function(e,r){var n=Math.max.apply(Math,(0,t.Z)(e.map((function(e){return e.i})))),a=Math.min.apply(Math,(0,t.Z)(r.map((function(e){return e.i}))));if(Math.abs(n-a)>1)return!0;var o=Math.max.apply(Math,(0,t.Z)(e.map((function(e){return e.j})))),f=Math.min.apply(Math,(0,t.Z)(r.map((function(e){return e.j}))));return Math.abs(o-f)>1},p=[["a1","b2","c3","d4","e5","f6","g7","h8"],["a2","b3","c4","d5","e6","f7","g8"],["a3","b4","c5","d6","e7","f8"],["a4","b5","c6","d7","e8"],["a5","b6","c7","d8"],["a6","b7","c8"],["a7","b8"],["b1","c2","d3","e4","f5","g6","h7"],["c1","d2","e3","f4","g5","h6"],["d1","e2","f3","g4","h5"],["e1","f2","g3","h4"],["f1","g2","h3"],["g1","h2"]],g=[["h1","g2","f3","e4","d5","c6","b7","a8"],["h2","g3","f4","e5","d6","c7","b8"],["h3","g4","f5","e6","d7","c8"],["h4","g5","f6","e7","d8"],["h5","g6","f7","e8"],["h6","g7","f8"],["h7","g8"],["g1","f2","e3","d4","c5","b6","a7"],["f1","e2","d3","c4","b5","a6"],["e1","d2","c3","b4","a5"],["d1","c2","b3","a4"],["c1","b2","a3"],["b1","a2"]],b={},y=0,m=["1","2","3","4","5","6","7","8"];y<m.length;y++)for(var M=m[y],O=function(){var e=x[k]+M;b[e]=[];var r,n=(0,a.Z)(p);try{for(n.s();!(r=n.n()).done;){var o,f=r.value;f.includes(e)&&(o=b[e]).push.apply(o,(0,t.Z)(f.filter((function(r){return r!==e}))))}}catch(l){n.e(l)}finally{n.f()}var i,c=(0,a.Z)(g);try{for(c.s();!(i=c.n()).done;){var s,u=i.value;u.includes(e)&&(s=b[e]).push.apply(s,(0,t.Z)(u.filter((function(r){return r!==e}))))}}catch(l){c.e(l)}finally{c.f()}},k=0,x=["a","b","c","d","e","f","g","h"];k<x.length;k++)O();var Z=function(e,r){for(var n=null,t=null,a=0;a<8&&(!n||!t);a++)for(var o=e[a],i=0;i<8&&(!n||!t);i++)if(o[i]){var c=o[i],s=c.type,u=c.color,l=c.square;s===r&&"w"===u?n=l:"n"===s&&"w"===u&&(t=l)}if(!t||!n)return!1;var h,v=parseInt(n.charAt(1)),d=f.indexOf(n.charAt(0)),p=parseInt(t.charAt(1)),g=f.indexOf(t.charAt(0)),y=d===g&&(2===Math.abs(v-p)||4===Math.abs(v-p))||v===p&&(2===Math.abs(d-g)||4===Math.abs(d-g));return y||(h=t,y=b[n].includes(h)),y},j=n(984).Chess,w=new RegExp("[#+]$"),A=new RegExp("#$"),S=[];self.onmessage=function(e){var r=JSON.parse(e.data),n=r.pieces,c=r.lookingForFen,s=r.fromSquare,u=r.nSquares,l=r.testFen,p=[],g=new j(l||c);if(!l){for(var b=g.board(),y=[],m=0;m<8;m++){y[m]=[];for(var M=0;M<8;M++)y[m][M]=!1}var O,k=(0,a.Z)(n);try{for(k.s();!(O=k.n()).done;)for(var x=O.value,C=["K","Q","R","B","N","P"].includes(x)?"w":"b",q=x.toLowerCase(),P=!1,N=0;N<8&&!P;N++)for(var R=b[N],W=0;W<8&&!P;W++){var I=R[W];if(I){var Q=I,F=Q.type,_=Q.color,B=Q.square;if(F===q&&_===C){var E="b"===F&&!y[N][W]&&"light"===g.squareColor(B);y[N][W]=!0,p.push(E),P=!0}}}}catch(te){k.e(te)}finally{k.f()}g.clear()}var J=0,K=n.includes("Q")&&n.includes("N");K&&J++;var L=n.includes("B")&&n.includes("N");L&&J++;for(var T=0,$=0;$<o.length&&-1===(T=o[$].indexOf(s));$++);for(var z=T+u,D=[],G=0;G<u-$;G++)D.push.apply(D,(0,t.Z)(o[$+G].slice(T,z)));var H=function(e){return!(!K||!Z(e,"q"))||!(!L||!Z(e,"b"))},U=r.pieces.indexOf("k"),V=function(){var e,r=g.moves().filter((function(e){return!w.test(e)&&!e.includes("x")})),n=0,t=null,o=!1,f=(0,a.Z)(r);try{for(f.s();!(e=f.n()).done;){var i=e.value;g.move(i);var c=g.moves(),s=0;o=!1;var u,h=(0,a.Z)(c);try{for(h.s();!(u=h.n()).done;){var v=u.value;g.move(v);var d=g.moves().filter((function(e){return A.test(e)&&!(e.includes("=Q")||e.includes("=R"))}));if((s=d.length)>0&&J>0){var p,b=(0,a.Z)(d);try{for(b.s();!(p=b.n()).done;){var y=p.value;if(g.move(y),H(g.board())&&(o=!0,console.log("black:",v," white2:",y)),g.undo(),o)break}}catch(te){b.e(te)}finally{b.f()}}if(g.undo(),0===s)break}}catch(te){h.e(te)}finally{h.f()}s>0&&(0===J||o)&&(l&&console.log("checkmate at second move",i),n++,t=i,console.log("firstMove:",t)),g.undo()}}catch(te){f.e(te)}finally{f.f()}return l&&console.log(1===n?"Position is problem":"Position is not problem"),1===n?t:null},X=[],Y=[],ee=null;if(""===s)console.log("Invalid fromSquare");else if(l){console.time();var re=V(),ne={fen:l,firstMove:re};self.postMessage(JSON.stringify(ne)),console.timeEnd()}else!function e(r,n){var o,c=r.shift().charAt(0),s=c.toLowerCase(),u=/[RNBKQP]/.test(c)?"w":"b",l="k"===c,b="b"===s,y=b&&p[n],m=(0,a.Z)(D);try{for(m.s();!(o=m.n()).done;){var M=o.value;if(!S.includes(M)&&("p"!==s||!M.includes("8")&&!M.includes("1"))){var O=g.put({type:s,color:u},M);if(g.isCheck()||l&&(g.isAttacked(M,"w")||M.endsWith("1")||M.endsWith("8")||M.startsWith("a")||M.startsWith("h")||"b"===u&&g.isAttacked(S[0],"b"))||b&&(y&&"dark"===g.squareColor(M)||!y&&"light"===g.squareColor(M)))g.remove(M);else if(O){var k=!1,x=!1,Z=!1;if(l&&(ee=null,h(X)),S.push(M),n<U?X.push({i:parseInt(M.charAt(1)),j:f.indexOf(M.charAt(0))}):Y.push({i:parseInt(M.charAt(1)),j:f.indexOf(M.charAt(0))}),n>0&&n<U?k=i(X):n>=U&&(Y.length>1&&(x=i(Y)),x||(x=d(X,Y)),n===U&&(Z=g.isAttacked(M,"w"))),!k&&!x&&!Z)if(0===r.length){var j=g.fen();if(console.log(j),v(Y)){var w=g.fen(),A=V();null!==A&&(A===ee||A.endsWith("=Q")||A.endsWith("=R")?A=null:(ee=A,console.log("------",S,"---",w)));var C={fen:w,firstMove:A};self.postMessage(JSON.stringify(C))}}else e((0,t.Z)(r),n+1);S.pop(),n<U?X.pop():Y.pop(),g.remove(M)}}}}catch(te){m.e(te)}finally{m.f()}}((0,t.Z)(r.pieces),0)}}},r={};function n(t){var a=r[t];if(void 0!==a)return a.exports;var o=r[t]={exports:{}};return e[t](o,o.exports,n),o.exports}n.m=e,n.x=function(){var e=n.O(void 0,[777],(function(){return n(505)}));return e=n.O(e)},function(){var e=[];n.O=function(r,t,a,o){if(!t){var f=1/0;for(u=0;u<e.length;u++){t=e[u][0],a=e[u][1],o=e[u][2];for(var i=!0,c=0;c<t.length;c++)(!1&o||f>=o)&&Object.keys(n.O).every((function(e){return n.O[e](t[c])}))?t.splice(c--,1):(i=!1,o<f&&(f=o));if(i){e.splice(u--,1);var s=a();void 0!==s&&(r=s)}}return r}o=o||0;for(var u=e.length;u>0&&e[u-1][2]>o;u--)e[u]=e[u-1];e[u]=[t,a,o]}}(),n.d=function(e,r){for(var t in r)n.o(r,t)&&!n.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:r[t]})},n.f={},n.e=function(e){return Promise.all(Object.keys(n.f).reduce((function(r,t){return n.f[t](e,r),r}),[]))},n.u=function(e){return"static/js/"+e+".0e9f84b3.chunk.js"},n.miniCssF=function(e){},n.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="/chess-problem/",function(){var e={505:1};n.f.i=function(r,t){e[r]||importScripts(n.p+n.u(r))};var r=self.webpackChunkchess_game=self.webpackChunkchess_game||[],t=r.push.bind(r);r.push=function(r){var a=r[0],o=r[1],f=r[2];for(var i in o)n.o(o,i)&&(n.m[i]=o[i]);for(f&&f(n);a.length;)e[a.pop()]=1;t(r)}}(),function(){var e=n.x;n.x=function(){return n.e(777).then(e)}}();n.x()}();
//# sourceMappingURL=505.59c892ec.chunk.js.map