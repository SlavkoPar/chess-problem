!function(){"use strict";var e={505:function(e,r,n){for(var a=n(762),t=n(62),o=[["a8","b8","c8","d8","e8","f8","g8","h8"],["a7","b7","c7","d7","e7","f7","g7","h7"],["a6","b6","c6","d6","e6","f6","g6","h6"],["a5","b5","c5","d5","e5","f5","g5","h5"],["a4","b4","c4","d4","e4","f4","g4","h4"],["a3","b3","c3","d3","e3","f3","g3","h3"],["a2","b2","c2","d2","e2","f2","g2","h2"],["a1","b1","c1","d1","e1","f1","g1","h1"]],f="abcdefgh",i=function(e){for(var r=e.map((function(e){return e.i})).sort(),n=0;n<r.length-1;n++)if(r[n+1]-r[n]>3)return!0;r=e.map((function(e){return e.j})).sort();for(var a=0;a<r.length-1;a++)if(r[a+1]-r[a]>3)return!0;return!1},c=9,u=-1,l=9,s=-1,v=function(e){c=9,u=-1,l=9,s=-1;var r,n=(0,a.Z)(e);try{for(n.s();!(r=n.n()).done;){var t=r.value,o=t.i,f=t.j;o<c&&(c=o),o>u&&(u=o),f<l&&(l=f),f>s&&(s=f)}}catch(i){n.e(i)}finally{n.f()}},h=function(e){var r,n=(0,a.Z)(e);try{for(n.s();!(r=n.n()).done;){var t=r.value,o=t.i,f=t.j;if(o>=c&&o<=u&&f>=l&&f<=s)return!0}}catch(i){n.e(i)}finally{n.f()}return!1},d=[["a1","b2","c3","d4","e5","f6","g7","h8"],["a2","b3","c4","d5","e6","f7","g8"],["a3","b4","c5","d6","e7","f8"],["a4","b5","c6","d7","e8"],["a5","b6","c7","d8"],["a6","b7","c8"],["a7","b8"],["b1","c2","d3","e4","f5","g6","h7"],["c1","d2","e3","f4","g5","h6"],["d1","e2","f3","g4","h5"],["e1","f2","g3","h4"],["f1","g2","h3"],["g1","h2"]],p=[["h1","g2","f3","e4","d5","c6","b7","a8"],["h2","g3","f4","e5","d6","c7","b8"],["h3","g4","f5","e6","d7","c8"],["h4","g5","f6","e7","d8"],["h5","g6","f7","e8"],["h6","g7","f8"],["h7","g8"],["g1","f2","e3","d4","c5","b6","a7"],["f1","e2","d3","c4","b5","a6"],["e1","d2","c3","b4","a5"],["d1","c2","b3","a4"],["c1","b2","a3"],["b1","a2"]],g={},b=0,y=["1","2","3","4","5","6","7","8"];b<y.length;b++)for(var m=y[b],O=function(){var e=k[j]+m;g[e]=[];var r,n=(0,a.Z)(d);try{for(n.s();!(r=n.n()).done;){var o,f=r.value;f.includes(e)&&(o=g[e]).push.apply(o,(0,t.Z)(f.filter((function(r){return r!==e}))))}}catch(s){n.e(s)}finally{n.f()}var i,c=(0,a.Z)(p);try{for(c.s();!(i=c.n()).done;){var u,l=i.value;l.includes(e)&&(u=g[e]).push.apply(u,(0,t.Z)(l.filter((function(r){return r!==e}))))}}catch(s){c.e(s)}finally{c.f()}},j=0,k=["a","b","c","d","e","f","g","h"];j<k.length;j++)O();for(var x=function(e,r){for(var n=null,a=null,t=0;t<8&&(!n||!a);t++)for(var o=e[t],i=0;i<8&&(!n||!a);i++)if(o[i]){var c=o[i],u=c.type,l=c.color,s=c.square;u===r&&"w"===l?n=s:"n"===u&&"w"===l&&(a=s)}if(!a||!n)return!1;var v,h=parseInt(n.charAt(1)),d=f.indexOf(n.charAt(0)),p=parseInt(a.charAt(1)),b=f.indexOf(a.charAt(0)),y=d===b&&(2===Math.abs(h-p)||4===Math.abs(h-p))||h===p&&(2===Math.abs(d-b)||4===Math.abs(d-b));return y||(v=a,y=g[n].includes(v)),y},Z={},w=function(e,r){for(var n=[],a=e-1;a<=e+1;a++)if(!(a<1||a>8))for(var t=r-1;t<=r+1;t++)t<0||a>7||a===e&&t===r||n.push(f[t]+a);return n},S=1;S<=8;S++)for(var M=0;M<8;M++)Z[f[M]+S]=w(S,M);var q=function(e,r){return Z[e].includes(r)},A=n(984).Chess,C=new RegExp("[#+]$"),P=new RegExp("#$"),R=[];self.onmessage=function(e){var r=JSON.parse(e.data),n=r.pieces,c=r.indexOfBlack,u=r.lookingForFen,l=r.fromSquare,s=r.toSquare,d=(r.nSquares,r.testFen),p=[],g=new A(d||u);if(!d){var b=function(e,r,n){for(var t=[],o=[],f=0;f<8;f++){o[f]=[];for(var i=0;i<8;i++)o[f][i]=!1}var c,u=(0,a.Z)(e);try{for(u.s();!(c=u.n()).done;)for(var l=c.value,s=["K","Q","R","B","N","P"].includes(l)?"w":"b",v=l.toLowerCase(),h=!1,d=0;d<8&&!h;d++)for(var p=r[d],g=0;g<8&&!h;g++){var b=p[g];if(b){var y=b,m=y.type,O=y.color,j=y.square;if(m===v&&O===s){var k="b"===m&&!o[d][g]&&"light"===n(j);o[d][g]=!0,t.push(k),h=!0}}}}catch(x){u.e(x)}finally{u.f()}return t}(n,g.board(),(function(e){return g.squareColor(e)}));p.push.apply(p,(0,t.Z)(b)),g.clear()}var y=0,m=n.includes("Q")&&n.includes("N");m&&y++;var O=n.includes("B")&&n.includes("N");O&&y++;var j=n.includes("R");j&&y++;var k,Z=[],w=(0,a.Z)(o);try{for(w.s();!(k=w.n()).done;){var S=k.value;Z.push.apply(Z,(0,t.Z)(S))}}catch(W){w.e(W)}finally{w.f()}for(var M=[],N=!1,I=0,Q=Z;I<Q.length;I++){var B=Q[I];B===l?N=!0:B===s&&(M.push(B),N=!1),N&&M.push(B)}var F=function(e){if(m&&x(e,"q"))return!0;if(O&&x(e,"b"))return!0;if(j){var r=E[0],n=J[J.length-1];if(r.i===n.i&&2===Math.abs(r.j-n.j))for(var a=0;a<R.length;a++)if("R"===R[a]&&E[a].j===n.j)return!0;if(r.j===n.j&&2===Math.abs(r.i-n.i))for(var t=0;t<R.length;t++)if("R"===R[t]&&E[t].i===n.i)return!0}return!1},_=function(){var e,r=g.moves().filter((function(e){return!C.test(e)&&!e.includes("x")})),n=0,t=null,o=!1,f=(0,a.Z)(r);try{for(f.s();!(e=f.n()).done;){var i=e.value;g.move(i);var c=g.moves(),u=0;o=!1;var l,s=(0,a.Z)(c);try{for(s.s();!(l=s.n()).done;){var v=l.value;g.move(v);var h=g.moves().filter((function(e){return P.test(e)&&!(e.includes("=Q")||e.includes("=R"))}));if((u=h.length)>0&&y>0){var p,b=(0,a.Z)(h);try{for(b.s();!(p=b.n()).done;){var m=p.value;if(g.move(m),F(g.board())&&(o=!0,console.log("black:",v," white2:",m)),g.undo(),o)break}}catch(W){b.e(W)}finally{b.f()}}if(g.undo(),0===u)break}}catch(W){s.e(W)}finally{s.f()}u>0&&(0===y||o)&&(d&&console.log("checkmate at second move",i),n++,t=i,console.log("firstMove:",t)),g.undo()}}catch(W){f.e(W)}finally{f.f()}return d&&console.log(1===n?"Position is problem":"Position is not problem"),1===n?t:null},E=[],J=[],K=null;if(""===l)console.log("Invalid fromSquare");else if(d){console.time();var L=_(),T={fen:d,firstMove:L};self.postMessage(JSON.stringify(T)),console.timeEnd()}else!function e(r,n){var o,u=r.shift().charAt(0),l=u.toLowerCase(),s=/[RNBKQP]/.test(u)?"w":"b",d=n>=c,b="K"===u,y="k"===u,m="b"===l,O=m&&p[n],j=b?M:Z,k=(0,a.Z)(j);try{for(k.s();!(o=k.n()).done;){var x=o.value;if(!R.includes(x)&&("p"!==l||!x.includes("8")&&!x.includes("1"))){var w=g.put({type:l,color:s},x),S=!1;if(m&&(O&&"dark"===g.squareColor(x)||!O&&"light"===g.squareColor(x))&&(S=!0),!S&&d&&(console.assert("b"===s,"Should be black piece"),y?(q(R[0],x)||g.isAttacked(x,"w"))&&(S=!0):g.isCheck()&&(S=!0,["q","r","b"].includes(l)&&!q(R[0],x)&&(S=!1))),S)g.remove(x);else if(w){var A=!1;if(y&&(K=null,v(E)),R.push(x),d?J.push({i:parseInt(x.charAt(1)),j:f.indexOf(x.charAt(0))}):E.push({i:parseInt(x.charAt(1)),j:f.indexOf(x.charAt(0))}),n===c&&(A=i(E)),!A)if(0===r.length){if(!i(J)&&h(J)){var C=g.fen(),P=_();null!==P&&(P===K||P.endsWith("=Q")||P.endsWith("=R")?P=null:(K=P,console.log("------",R,"---",C)));var N={fen:C,firstMove:P};self.postMessage(JSON.stringify(N))}}else e((0,t.Z)(r),n+1);R.pop(),d?J.pop():E.pop(),g.remove(x)}}}}catch(W){k.e(W)}finally{k.f()}}((0,t.Z)(r.pieces),0)}}},r={};function n(a){var t=r[a];if(void 0!==t)return t.exports;var o=r[a]={exports:{}};return e[a](o,o.exports,n),o.exports}n.m=e,n.x=function(){var e=n.O(void 0,[777],(function(){return n(505)}));return e=n.O(e)},function(){var e=[];n.O=function(r,a,t,o){if(!a){var f=1/0;for(l=0;l<e.length;l++){a=e[l][0],t=e[l][1],o=e[l][2];for(var i=!0,c=0;c<a.length;c++)(!1&o||f>=o)&&Object.keys(n.O).every((function(e){return n.O[e](a[c])}))?a.splice(c--,1):(i=!1,o<f&&(f=o));if(i){e.splice(l--,1);var u=t();void 0!==u&&(r=u)}}return r}o=o||0;for(var l=e.length;l>0&&e[l-1][2]>o;l--)e[l]=e[l-1];e[l]=[a,t,o]}}(),n.d=function(e,r){for(var a in r)n.o(r,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:r[a]})},n.f={},n.e=function(e){return Promise.all(Object.keys(n.f).reduce((function(r,a){return n.f[a](e,r),r}),[]))},n.u=function(e){return"static/js/"+e+".0e9f84b3.chunk.js"},n.miniCssF=function(e){},n.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="/chess-problem/",function(){var e={505:1};n.f.i=function(r,a){e[r]||importScripts(n.p+n.u(r))};var r=self.webpackChunkchess_game=self.webpackChunkchess_game||[],a=r.push.bind(r);r.push=function(r){var t=r[0],o=r[1],f=r[2];for(var i in o)n.o(o,i)&&(n.m[i]=o[i]);for(f&&f(n);t.length;)e[t.pop()]=1;a(r)}}(),function(){var e=n.x;n.x=function(){return n.e(777).then(e)}}();n.x()}();
//# sourceMappingURL=505.84cc4d8f.chunk.js.map